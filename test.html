<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Agenda Online</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }

    h1 {
      margin-bottom: 30px;
    }

    button {
      padding: 8px 14px;
      margin: 5px;
      border: 1px solid #999;
      background: #eee;
      cursor: pointer;
    }

    button.activo {
      background: #72bd99;
      color: white;
      border: none;
    }

    .dia {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #ccc;
    }
  </style>
</head>
<body>

<h1>Agenda Online</h1>

<h3>1️⃣ Elegí el servicio</h3>

<button onclick="seleccionarServicio('Facial')" id="btnFacial">Facial</button>
<button onclick="seleccionarServicio('Limpieza')" id="btnLimpieza">Limpieza</button>
<button onclick="seleccionarServicio('Corporal')" id="btnCorporal">Corporal</button>

<hr>

<h3>2️⃣ Elegí horario disponible</h3>

<button onclick="cargarHorarios()">Ver Horarios Disponibles</button>

<div id="agenda"></div>

<script>

const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbyoUI9SV-YyKHEVNJoWrocLm6QYuYUjq-mY90kLedJwJMrqI_OAItkeAbW32ejQVRVf/exec";

let servicioSeleccionado = null;

function seleccionarServicio(servicio) {
  servicioSeleccionado = servicio;

  document.querySelectorAll("button").forEach(b => b.classList.remove("activo"));

  if(servicio === "Facial") document.getElementById("btnFacial").classList.add("activo");
  if(servicio === "Limpieza") document.getElementById("btnLimpieza").classList.add("activo");
  if(servicio === "Corporal") document.getElementById("btnCorporal").classList.add("activo");
}

function cargarHorarios() {

  fetch(URL_SCRIPT + "?action=generarAgenda")
    .then(res => res.json())
    .then(data => {

      const contenedor = document.getElementById("agenda");
      contenedor.innerHTML = "";

      data.forEach(dia => {

        const divDia = document.createElement("div");
        divDia.className = "dia";

        const titulo = document.createElement("h4");
        titulo.innerText = dia.fecha + " - " + dia.bloquesDisponibles.length + " turnos";
        divDia.appendChild(titulo);

        dia.bloquesDisponibles.forEach(bloque => {

          const btn = document.createElement("button");
          btn.innerText = bloque.hora;

          btn.onclick = () => reservarTurno(bloque.fecha, bloque.hora);

          divDia.appendChild(btn);
        });

        contenedor.appendChild(divDia);
      });
    });
}

function reservarTurno(fecha, hora) {

  if(!servicioSeleccionado) {
    alert("Primero seleccioná un servicio");
    return;
  }

  fetch(URL_SCRIPT, {
    method: "POST",
    body: JSON.stringify({
      fecha: fecha,
      hora: hora,
      servicio: servicioSeleccionado
    })
  })
  .then(res => res.json())
  .then(res => {
    if(res.ok) {
      alert("Turno reservado correctamente");
      cargarHorarios();
    } else {
      alert("Error al reservar");
    }
  });
}

</script>

</body>
</html>
