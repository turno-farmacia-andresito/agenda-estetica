<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Agenda Online</title>
</head>

<body>

<h1>Agenda Online</h1>

<h3>1️⃣ Elegí el servicio</h3>
<button onclick="seleccionarServicio('Facial')">Facial</button>
<button onclick="seleccionarServicio('Limpieza')">Limpieza</button>
<button onclick="seleccionarServicio('Corporal')">Corporal</button>

<hr>

<h3>2️⃣ Elegí horario disponible</h3>
<button onclick="cargarAgenda()">Ver Horarios Disponibles</button>

<div id="agenda"></div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbwbmSWJuaoK-5ltcw4Bbk_xqW5ZzInCAfjdxjYh2avUkCoRJjzuQPtwyDF7Yol0t1Ry/exec";

let servicioSeleccionado = null;

function seleccionarServicio(servicio) {
  servicioSeleccionado = servicio;
  alert("Servicio seleccionado: " + servicio);
}

async function cargarAgenda() {

  const contenedor = document.getElementById("agenda");
  contenedor.innerHTML = "Cargando...";

  const response = await fetch(API_URL + "?action=agenda");
  const data = await response.json();

  contenedor.innerHTML = "";

  data.forEach(dia => {

    if (dia.bloquesDisponibles.length === 0) return;

    const titulo = document.createElement("h3");
    titulo.textContent = `${dia.fecha} (${dia.dia})`;
    contenedor.appendChild(titulo);

    dia.bloquesDisponibles.forEach(bloque => {

      const btn = document.createElement("button");
      btn.textContent = bloque.hora;
      btn.style.margin = "5px";

      btn.onclick = () => reservarTurno(bloque.fecha, bloque.hora);

      contenedor.appendChild(btn);
    });

  });
}

async function reservarTurno(fecha, hora) {

  if (!servicioSeleccionado) {
    alert("Primero elegí un servicio");
    return;
  }

  const nombre = prompt("Ingresá tu nombre:");
  if (!nombre) return;

  const response = await fetch(API_URL + "?action=reservar", {
    method: "POST",
    body: JSON.stringify({
      fecha: fecha,
      hora: hora,
      servicio: servicioSeleccionado,
      nombre: nombre
    })
  });

  const data = await response.json();

  if (data.success) {
    alert("Reserva confirmada ✅");
    await cargarAgenda();
  } else {
    alert("Error al reservar");
  }
}

</script>

</body>
</html>
