<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
}

h1 {
  margin-bottom: 20px;
}

.boton-servicio,
.boton-hora {
  margin: 5px;
  padding: 8px 14px;
  border: 1px solid #333;
  background: #f4f4f4;
  cursor: pointer;
  border-radius: 6px;
}

.boton-servicio.activo {
  background: #72bd99;
  color: white;
  border: none;
}

.seccion {
  margin-top: 25px;
}

hr {
  margin: 25px 0;
}
</style>

</head>
<body>

<h1>Agenda Online</h1>

<div class="seccion">
  <h3>1️⃣ Elegí el servicio</h3>
  <button class="boton-servicio" onclick="seleccionarServicio('Facial')">Facial</button>
  <button class="boton-servicio" onclick="seleccionarServicio('Limpieza')">Limpieza</button>
  <button class="boton-servicio" onclick="seleccionarServicio('Corporal')">Corporal</button>
</div>

<hr>

<div class="seccion">
  <h3>2️⃣ Elegí horario disponible</h3>
  <button onclick="cargarAgenda()">Ver Horarios Disponibles</button>
  <div id="agenda"></div>
</div>

<script>

const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbwbmSWJuaoK-5ltcw4Bbk_xqW5ZzInCAfjdxjYh2avUkCoRJjzuQPtwyDF7Yol0t1Ry/exec";

let servicioSeleccionado = null;

function seleccionarServicio(servicio) {
  servicioSeleccionado = servicio;

  document.querySelectorAll(".boton-servicio").forEach(btn => {
    btn.classList.remove("activo");
  });

  event.target.classList.add("activo");
}

function cargarAgenda() {

  fetch(URL_SCRIPT + "?action=generarAgenda")
    .then(res => res.json())
    .then(data => {

      const contenedor = document.getElementById("agenda");
      contenedor.innerHTML = "";

      data.forEach(dia => {

        if (dia.bloquesDisponibles.length === 0) return;

        let titulo = document.createElement("h3");
        titulo.textContent = `${dia.fecha} (${dia.dia})`;
        contenedor.appendChild(titulo);

        dia.bloquesDisponibles.forEach(bloque => {

          let boton = document.createElement("button");
          boton.className = "boton-hora";
          boton.textContent = bloque.hora;

          boton.onclick = () => reservar(bloque.fecha, bloque.hora);

          contenedor.appendChild(boton);
        });

      });

    })
    .catch(err => {
      console.error("Error:", err);
    });

}

function reservar(fecha, hora) {

  if (!servicioSeleccionado) {
    alert("Primero seleccioná un servicio");
    return;
  }

  alert(
    "Reserva confirmada\n\n" +
    "Servicio: " + servicioSeleccionado + "\n" +
    "Fecha: " + fecha + "\n" +
    "Hora: " + hora
  );

}

</script>

</body>
</html>
