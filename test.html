<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Agenda Online</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }

    h1 {
      margin-bottom: 20px;
    }

    .botones-servicio button {
      padding: 8px 15px;
      margin-right: 10px;
      cursor: pointer;
      border: 1px solid #888;
      background: #eee;
    }

    .botones-servicio button.activo {
      background: #72bd99;
      color: white;
      border: none;
    }

    .horario-btn {
      padding: 6px 10px;
      margin: 5px;
      border: 1px solid #888;
      background: #f5f5f5;
      cursor: pointer;
    }

    .horario-btn:hover {
      background: #72bd99;
      color: white;
    }

    .dia {
      margin-top: 25px;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }
  </style>
</head>

<body>

<h1>Agenda Online</h1>

<h3>1️⃣ Elegí el servicio</h3>

<div class="botones-servicio">
  <button onclick="seleccionarServicio(this,'Facial')">Facial</button>
  <button onclick="seleccionarServicio(this,'Limpieza')">Limpieza</button>
  <button onclick="seleccionarServicio(this,'Corporal')">Corporal</button>
</div>

<br>

<h3>2️⃣ Elegí horario disponible</h3>
<button onclick="cargarHorarios()">Ver Horarios Disponibles</button>

<div id="agenda"></div>


<script>

const API_URL = "https://script.google.com/macros/s/AKfycbzuiufqrR6Jf549-yFuGia2p_Ej--wijPukTTx-UfGVDFWkhy2mcTyMA_lNlVEJwg_2/exec";

let servicioSeleccionado = null;


// ======================
// Selección de servicio
// ======================
function seleccionarServicio(btn, servicio) {

  servicioSeleccionado = servicio;

  document.querySelectorAll(".botones-servicio button")
    .forEach(b => b.classList.remove("activo"));

  btn.classList.add("activo");
}


// ======================
// Cargar horarios
// ======================
function cargarHorarios() {

  fetch(API_URL)
    .then(r => r.json())
    .then(data => {

      const contenedor = document.getElementById("agenda");
      contenedor.innerHTML = "";

      data.forEach(dia => {

        const divDia = document.createElement("div");
        divDia.className = "dia";

        const titulo = document.createElement("h4");
        titulo.textContent = `${dia.fecha} - ${dia.bloquesDisponibles.length} turnos`;
        divDia.appendChild(titulo);

        dia.bloquesDisponibles.forEach(bloque => {

          const btn = document.createElement("button");
          btn.className = "horario-btn";
          btn.textContent = bloque.hora;

          btn.onclick = () => reservarTurno(bloque.fecha, bloque.hora);

          divDia.appendChild(btn);
        });

        contenedor.appendChild(divDia);
      });

    })
    .catch(() => alert("Error cargando horarios."));
}


// ======================
// Reservar turno
// ======================
function reservarTurno(fecha, hora) {

  if (!servicioSeleccionado) {
    alert("Primero seleccioná un servicio.");
    return;
  }

  fetch(`${API_URL}?action=reservar&fecha=${fecha}&hora=${hora}&servicio=${servicioSeleccionado}`)
    .then(r => r.json())
    .then(res => {

      if (res.ok) {
        alert("Turno reservado correctamente");
        cargarHorarios(); // refresca
      } else {
        alert("Error al reservar");
      }

    })
    .catch(() => alert("Error de conexión."));
}

</script>

</body>
</html>
