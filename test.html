<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Agenda Online</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { margin: 5px; padding: 8px 12px; cursor: pointer; }
    .horarios { margin-top: 20px; }
    .dia { margin-top: 25px; }
  </style>
</head>
<body>

<h1>Agenda Online</h1>

<h3>1️⃣ Elegí el servicio</h3>

<div id="servicios">
  <button onclick="seleccionarServicio('Facial')">Facial</button>
  <button onclick="seleccionarServicio('Limpieza')">Limpieza</button>
  <button onclick="seleccionarServicio('Corporal')">Corporal</button>
</div>

<hr>

<div id="agenda" style="display:none;">
  <h3>2️⃣ Elegí horario disponible</h3>
  <button onclick="cargarAgenda()">Ver Horarios Disponibles</button>
  <div id="resultado" class="horarios"></div>
</div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbwbmSWJuaoK-5ltcw4Bbk_xqW5ZzInCAfjdxjYh2avUkCoRJjzuQPtwyDF7Yol0t1Ry/exec";

let servicioSeleccionado = null;

function seleccionarServicio(servicio) {
  servicioSeleccionado = servicio;
  alert("Servicio seleccionado: " + servicio);
  document.getElementById("agenda").style.display = "block";
}

function cargarAgenda() {
  fetch(API_URL + "?action=agenda")
    .then(res => res.json())
    .then(data => mostrarAgenda(data));
}

function mostrarAgenda(data) {
  const contenedor = document.getElementById("resultado");
  contenedor.innerHTML = "";

  data.forEach(dia => {
    if (dia.bloquesDisponibles.length === 0) return;

    const divDia = document.createElement("div");
    divDia.className = "dia";

    divDia.innerHTML = "<h3>" + dia.fecha + " (" + dia.dia + ")</h3>";

    dia.bloquesDisponibles.forEach(b => {
      const btn = document.createElement("button");
      btn.textContent = b.hora;
      btn.onclick = () => reservarTurno(b.fecha, b.hora);
      divDia.appendChild(btn);
    });

    contenedor.appendChild(divDia);
  });
}

function reservarTurno(fecha, hora) {

  if (!servicioSeleccionado) {
    alert("Primero seleccioná un servicio");
    return;
  }

  const nombre = prompt("Tu nombre:");
  const telefono = prompt("Tu teléfono:");

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "reservar",
      fecha: fecha,
      hora: hora,
      servicio: servicioSeleccionado,
      nombre: nombre,
      telefono: telefono
    })
  })
  .then(res => res.json())
  .then(resp => {
    alert("Reserva confirmada");
    cargarAgenda();
  });
}

</script>

</body>
</html>
