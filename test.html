<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 30px;
}

h1 {
  margin-bottom: 30px;
}

.section {
  margin-bottom: 40px;
}

button {
  padding: 8px 14px;
  margin: 5px;
  cursor: pointer;
}

.servicio-btn.active {
  background-color: #72bd99;
  color: white;
  border: none;
}

.hora-btn {
  border: 1px solid #999;
  background: white;
}

.hora-btn:hover {
  background: #72bd99;
  color: white;
}
</style>
</head>

<body>

<h1>Agenda Online</h1>

<div class="section">
  <h3>1️⃣ Elegí el servicio</h3>
  <button class="servicio-btn" onclick="seleccionarServicio(this,'Facial')">Facial</button>
  <button class="servicio-btn" onclick="seleccionarServicio(this,'Limpieza')">Limpieza</button>
  <button class="servicio-btn" onclick="seleccionarServicio(this,'Corporal')">Corporal</button>
</div>

<div class="section">
  <h3>2️⃣ Elegí horario disponible</h3>
  <button onclick="cargarHorarios()">Ver Horarios Disponibles</button>
  <div id="agenda"></div>
</div>

<script>

let servicioSeleccionado = null;

function seleccionarServicio(btn, servicio) {
  servicioSeleccionado = servicio;

  document.querySelectorAll('.servicio-btn')
    .forEach(b => b.classList.remove('active'));

  btn.classList.add('active');
}

function cargarHorarios() {

  fetch("https://script.google.com/macros/s/AKfycbxSrByl2wsxSOBnf5Zd6beqyh-YFDfqddCfvDpTGSiSsMRNYleSt_XIvEl5pz2ofeU/exec?action=generarAgenda")
    .then(res => res.json())
    .then(data => mostrarAgenda(data))
    .catch(err => {
      console.error(err);
      alert("Error al cargar horarios");
    });
}

function mostrarAgenda(data) {

  const contenedor = document.getElementById("agenda");
  contenedor.innerHTML = "";

  data.forEach(dia => {

    if (!dia.bloquesDisponibles.length) return;

    const titulo = document.createElement("h4");
    titulo.innerText = dia.fecha + " (" + dia.dia + ")";
    contenedor.appendChild(titulo);

    dia.bloquesDisponibles.forEach(bloque => {

      const btn = document.createElement("button");
      btn.className = "hora-btn";
      btn.innerText = bloque.hora;

      btn.onclick = () => reservarTurno(bloque.fecha, bloque.hora);

      contenedor.appendChild(btn);
    });

  });
}

function reservarTurno(fecha, hora) {

  if (!servicioSeleccionado) {
    alert("Primero elegí un servicio");
    return;
  }

  alert("Reserva confirmada:\n" +
        servicioSeleccionado + "\n" +
        fecha + " - " + hora);
}

</script>

</body>
</html>
