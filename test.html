<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 40px;
}

h1 {
  margin-bottom: 30px;
}

button {
  padding: 8px 14px;
  margin: 4px;
  cursor: pointer;
}

.servicio-btn.activo {
  background-color: #72bd99;
  color: white;
  border: none;
}

.dia {
  margin-top: 20px;
  padding-top: 10px;
  border-top: 1px solid #ccc;
}

.horas button {
  background-color: #f2f2f2;
  border: 1px solid #ccc;
}

.horas button:hover {
  background-color: #72bd99;
  color: white;
}
</style>
</head>

<body>

<h1>Agenda Online</h1>

<h3>1️⃣ Elegí el servicio</h3>

<button class="servicio-btn" onclick="seleccionarServicio(this,'Facial')">Facial</button>
<button class="servicio-btn" onclick="seleccionarServicio(this,'Limpieza')">Limpieza</button>
<button class="servicio-btn" onclick="seleccionarServicio(this,'Corporal')">Corporal</button>

<hr>

<h3>2️⃣ Elegí horario disponible</h3>

<button onclick="cargarHorarios()">Ver Horarios Disponibles</button>

<div id="agenda"></div>

<script>

let servicioSeleccionado = null;

const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbxcaoF_8mYGwFDWY3Vby0lpM_6oQlpjuQq52gPTsrnFwy5rqsKoBEfk3g42y5DI4YRi/exec";

function seleccionarServicio(btn, servicio) {

  document.querySelectorAll(".servicio-btn").forEach(b => b.classList.remove("activo"));

  btn.classList.add("activo");
  servicioSeleccionado = servicio;
}

function cargarHorarios() {

  fetch(URL_SCRIPT + "?action=generarAgenda")
    .then(res => res.json())
    .then(data => mostrarAgenda(data))
    .catch(err => {
      console.error(err);
      alert("Error cargando agenda");
    });
}

function mostrarAgenda(data) {

  const contenedor = document.getElementById("agenda");
  contenedor.innerHTML = "";

  data.forEach(dia => {

    const divDia = document.createElement("div");
    divDia.className = "dia";

    const titulo = document.createElement("h4");
    titulo.textContent = dia.fecha + " - " + dia.bloquesDisponibles.length + " turnos";

    divDia.appendChild(titulo);

    const divHoras = document.createElement("div");
    divHoras.className = "horas";

    dia.bloquesDisponibles.forEach(bloque => {

      const btn = document.createElement("button");
      btn.textContent = bloque.hora;

      btn.onclick = () => reservarTurno(bloque.fecha, bloque.hora);

      divHoras.appendChild(btn);
    });

    divDia.appendChild(divHoras);
    contenedor.appendChild(divDia);
  });
}

function reservarTurno(fecha, hora) {

  if (!servicioSeleccionado) {
    alert("Primero seleccioná un servicio");
    return;
  }

  alert("Reserva simulada:\nServicio: " + servicioSeleccionado + "\nFecha: " + fecha + "\nHora: " + hora);
}

</script>

</body>
</html>
