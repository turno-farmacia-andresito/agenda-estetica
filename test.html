<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}

h1 {
  font-size: 32px;
}

.seccion {
  margin-top: 30px;
}

button {
  padding: 8px 14px;
  margin: 4px;
  border: 1px solid #999;
  background: #e0e0e0;
  cursor: pointer;
  border-radius: 4px;
}

button.activo {
  background: #72bd99;
  color: white;
  border: none;
}

.fecha-bloque {
  margin-top: 20px;
  padding-top: 10px;
  border-top: 1px solid #ccc;
}

.horas {
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>Agenda Online</h1>

<div class="seccion">
  <h3>1️⃣ Elegí el servicio</h3>
  <button onclick="seleccionarServicio(this,'Facial')" class="activo">Facial</button>
  <button onclick="seleccionarServicio(this,'Limpieza')">Limpieza</button>
  <button onclick="seleccionarServicio(this,'Corporal')">Corporal</button>
</div>

<div class="seccion">
  <h3>2️⃣ Elegí horario disponible</h3>
  <button onclick="cargarHorarios()">Ver Horarios Disponibles</button>
  <div id="agenda"></div>
</div>

<script>

let servicioSeleccionado = "Facial";

function seleccionarServicio(btn, servicio) {
  document.querySelectorAll("button").forEach(b => b.classList.remove("activo"));
  btn.classList.add("activo");
  servicioSeleccionado = servicio;
}

function cargarHorarios() {

  fetch("https://script.google.com/macros/s/AKfycbx4fGHTirPqMOp4t5oBHZA2dSgZ3m6Sck4JpuksKoc3Qe2L-6X0K4jTyvcSr2QggfkW/exec?action=generarAgenda")
  .then(res => res.json())
  .then(data => {

    const agendaDiv = document.getElementById("agenda");
    agendaDiv.innerHTML = "";

    data.forEach(dia => {

      const contenedor = document.createElement("div");
      contenedor.className = "fecha-bloque";

      const titulo = document.createElement("strong");
      titulo.textContent = `${dia.fecha} - ${dia.bloquesDisponibles.length} turnos`;
      contenedor.appendChild(titulo);

      const horasDiv = document.createElement("div");
      horasDiv.className = "horas";

      dia.bloquesDisponibles.forEach(b => {

        const btnHora = document.createElement("button");
        btnHora.textContent = b.hora;

        btnHora.onclick = () => {
          alert(
            "Reservar:\n" +
            "Servicio: " + servicioSeleccionado +
            "\nFecha: " + b.fecha +
            "\nHora: " + b.hora
          );
        };

        horasDiv.appendChild(btnHora);
      });

      contenedor.appendChild(horasDiv);
      agendaDiv.appendChild(contenedor);

    });

  })
  .catch(err => {
    console.error(err);
    alert("Error cargando horarios");
  });

}

</script>

</body>
</html>
