<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 40px;
}

h1 {
  margin-bottom: 20px;
}

.seccion {
  margin-bottom: 30px;
}

button {
  padding: 8px 14px;
  margin: 5px;
  border: 1px solid #333;
  background: #f4f4f4;
  cursor: pointer;
  border-radius: 4px;
}

button.activo {
  background: #72bd99;
  color: white;
  border: none;
}

.horarios button {
  margin: 4px;
}
</style>
</head>

<body>

<h1>Agenda Online</h1>

<div class="seccion">
  <h3>1️⃣ Elegí el servicio</h3>
  <button onclick="seleccionarServicio(this)">Facial</button>
  <button onclick="seleccionarServicio(this)">Limpieza</button>
  <button onclick="seleccionarServicio(this)">Corporal</button>
</div>

<hr>

<div class="seccion">
  <h3>2️⃣ Elegí horario disponible</h3>
  <button onclick="cargarAgenda()">Ver Horarios Disponibles</button>
  <div id="agenda"></div>
</div>

<script>

let servicioSeleccionado = null;

function seleccionarServicio(btn) {
  document.querySelectorAll(".seccion button").forEach(b => {
    b.classList.remove("activo");
  });

  btn.classList.add("activo");
  servicioSeleccionado = btn.textContent;
}

function cargarAgenda() {

  if (!servicioSeleccionado) {
    alert("Primero seleccioná un servicio");
    return;
  }

  fetch("https://script.google.com/macros/s/AKfycbyec_jJOE9A7v-zdjJ6z2Wuqt19_dqmGSrLxa0h-64vZk2K_xlZju6QQ40RtB3AEW4u/exec?action=generarAgenda")
    .then(res => res.json())
    .then(data => {

      const contenedor = document.getElementById("agenda");
      contenedor.innerHTML = "";

      data.forEach(dia => {

        const titulo = document.createElement("h4");
        titulo.textContent = dia.fecha + " (" + dia.dia + ")";
        contenedor.appendChild(titulo);

        const divHorarios = document.createElement("div");
        divHorarios.className = "horarios";

        dia.bloquesDisponibles.forEach(bloque => {
          const btn = document.createElement("button");
          btn.textContent = bloque.hora;
          btn.onclick = () => reservarTurno(bloque.fecha, bloque.hora);
          divHorarios.appendChild(btn);
        });

        contenedor.appendChild(divHorarios);
      });

    })
    .catch(error => {
      console.error("Error:", error);
      alert("Error al cargar la agenda");
    });
}

function reservarTurno(fecha, hora) {

  const nombre = prompt("Ingresá tu nombre:");
  if (!nombre) return;

  fetch("https://script.google.com/macros/s/AKfycbyec_jJOE9A7v-zdjJ6z2Wuqt19_dqmGSrLxa0h-64vZk2K_xlZju6QQ40RtB3AEW4u/exec?action=reservar&fecha=" 
        + fecha + 
        "&hora=" + hora + 
        "&servicio=" + servicioSeleccionado + 
        "&nombre=" + nombre)
    .then(res => res.json())
    .then(response => {

      if (response.ok) {
        alert("Reserva confirmada");
        cargarAgenda();
      } else {
        alert("Error al reservar");
      }

    });
}

</script>

</body>
</html>
