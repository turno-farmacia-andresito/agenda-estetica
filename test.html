<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial;
  margin: 40px;
}

h1 {
  margin-bottom: 20px;
}

.boton-servicio {
  padding: 8px 14px;
  margin-right: 10px;
  border: 1px solid #333;
  background: #f5f5f5;
  cursor: pointer;
}

.boton-servicio.activo {
  background: #72bd99;
  color: white;
  border: none;
}

.hora-btn {
  padding: 6px 10px;
  margin: 4px;
  border: 1px solid #333;
  background: white;
  cursor: pointer;
}

.hora-btn:hover {
  background: #72bd99;
  color: white;
  border: none;
}
</style>
</head>

<body>

<h1>Agenda Online</h1>

<h3>1️⃣ Elegí el servicio</h3>
<button class="boton-servicio" onclick="seleccionarServicio(this)">Facial</button>
<button class="boton-servicio" onclick="seleccionarServicio(this)">Limpieza</button>
<button class="boton-servicio" onclick="seleccionarServicio(this)">Corporal</button>

<hr>

<h3>2️⃣ Elegí horario disponible</h3>
<button onclick="cargarAgenda()">Ver Horarios Disponibles</button>

<div id="agenda"></div>

<script>

const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbxSrByl2wsxSOBnf5Zd6beqyh-YFDfqddCfvDpTGSiSsMRNYleSt_XIvEl5pz2ofeU/exec";

let servicioSeleccionado = null;

function seleccionarServicio(btn) {
  document.querySelectorAll(".boton-servicio").forEach(b => b.classList.remove("activo"));
  btn.classList.add("activo");
  servicioSeleccionado = btn.innerText;
}

function cargarAgenda() {

  fetch(URL_SCRIPT + "?action=generarAgenda")
    .then(res => res.json())
    .then(data => {

      const contenedor = document.getElementById("agenda");
      contenedor.innerHTML = "";

      data.forEach(dia => {

        if (dia.bloquesDisponibles.length === 0) return;

        const titulo = document.createElement("h3");
        titulo.innerText = dia.fecha + " (" + dia.dia + ")";
        contenedor.appendChild(titulo);

        dia.bloquesDisponibles.forEach(bloque => {

          const btn = document.createElement("button");
          btn.className = "hora-btn";
          btn.innerText = bloque.hora;

          btn.onclick = function() {

            if (!servicioSeleccionado) {
              alert("Primero elegí un servicio");
              return;
            }

            alert(
              "Servicio: " + servicioSeleccionado +
              "\nFecha: " + bloque.fecha +
              "\nHora: " + bloque.hora
            );
          };

          contenedor.appendChild(btn);
        });

      });

    });

}

</script>

</body>
</html>
