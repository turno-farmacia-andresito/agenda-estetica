<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 40px;
}

h1 {
  margin-bottom: 30px;
}

button {
  padding: 8px 14px;
  margin: 4px;
  border-radius: 6px;
  border: 1px solid #ccc;
  cursor: pointer;
}

button:hover {
  background-color: #f0f0f0;
}

.servicio-activo {
  background-color: #72bd99;
  color: white;
  border: none;
}

.horario-btn {
  background-color: #f5f5f5;
}

.horario-btn:hover {
  background-color: #72bd99;
  color: white;
}

.seccion {
  margin-bottom: 30px;
}
</style>
</head>

<body>

<h1>Agenda Online</h1>

<div class="seccion">
  <h3>1️⃣ Elegí el servicio</h3>
  <button onclick="seleccionarServicio(this)">Facial</button>
  <button onclick="seleccionarServicio(this)">Limpieza</button>
  <button onclick="seleccionarServicio(this)">Corporal</button>
</div>

<hr>

<div class="seccion">
  <h3>2️⃣ Elegí horario disponible</h3>
  <button onclick="cargarAgenda()">Ver Horarios Disponibles</button>
</div>

<div id="agenda"></div>

<script>

const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbzIeuaYwueVSG_TZiRlSLkzGy4oZ4z0mu4IQ2eYl-iLzxBX7Rq_zJujVMOR-MT-oC5H/exec";

let servicioSeleccionado = null;

function seleccionarServicio(btn) {

  document.querySelectorAll("button").forEach(b => {
    b.classList.remove("servicio-activo");
  });

  btn.classList.add("servicio-activo");
  servicioSeleccionado = btn.innerText;
}

function cargarAgenda() {

  if (!servicioSeleccionado) {
    alert("Primero seleccioná un servicio");
    return;
  }

  fetch(URL_SCRIPT + "?action=generarAgenda")
    .then(res => res.json())
    .then(data => mostrarAgenda(data))
    .catch(err => {
      console.error(err);
      alert("Error cargando agenda");
    });
}

function mostrarAgenda(data) {

  const contenedor = document.getElementById("agenda");
  contenedor.innerHTML = "";

  data.forEach(dia => {

    const titulo = document.createElement("h4");
    titulo.innerText = dia.fecha + " (" + dia.dia + ") - " + dia.bloquesDisponibles.length + " disponibles";
    contenedor.appendChild(titulo);

    dia.bloquesDisponibles.forEach(bloque => {

      const btn = document.createElement("button");
      btn.classList.add("horario-btn");
      btn.innerText = bloque.hora;

      btn.onclick = function() {
        confirmarReserva(bloque.fecha, bloque.hora);
      };

      contenedor.appendChild(btn);
    });

    contenedor.appendChild(document.createElement("hr"));
  });
}

function confirmarReserva(fecha, hora) {
  alert("Reservando " + servicioSeleccionado + " el " + fecha + " a las " + hora);
}

</script>

</body>
</html>
