<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
}

h1 {
  margin-bottom: 20px;
}

.section {
  margin-bottom: 30px;
}

button {
  padding: 8px 12px;
  margin: 5px;
  cursor: pointer;
}

.servicio-btn.activo {
  background-color: #72bd99;
  color: white;
  border: none;
}

.horario-btn {
  margin: 4px;
}

hr {
  margin: 20px 0;
}
</style>
</head>
<body>

<h1>Agenda Online</h1>

<div class="section">
  <h3>1️⃣ Elegí el servicio</h3>

  <button class="servicio-btn" onclick="seleccionarServicio(this,'Facial')">Facial</button>
  <button class="servicio-btn" onclick="seleccionarServicio(this,'Limpieza')">Limpieza</button>
  <button class="servicio-btn" onclick="seleccionarServicio(this,'Corporal')">Corporal</button>
</div>

<hr>

<div class="section">
  <h3>2️⃣ Elegí horario disponible</h3>
  <button onclick="cargarHorarios()">Ver Horarios Disponibles</button>

  <div id="agenda"></div>
</div>

<script>

const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbysWQS1qblcorp28gzoBcjLaID8Ksmx-qua4z8D12JrPZworui3eZQnGt0ANV1QUpPW/exec?action=generarAgenda";

let servicioSeleccionado = null;

function seleccionarServicio(btn, servicio) {
  document.querySelectorAll('.servicio-btn').forEach(b => b.classList.remove('activo'));
  btn.classList.add('activo');
  servicioSeleccionado = servicio;
}

function cargarHorarios() {

  fetch(URL_SCRIPT)
    .then(res => res.json())
    .then(data => {

      const contenedor = document.getElementById("agenda");
      contenedor.innerHTML = "";

      data.forEach(dia => {

        const titulo = document.createElement("h4");
        titulo.textContent = dia.fecha + " - " + dia.bloquesDisponibles.length + " turnos";
        contenedor.appendChild(titulo);

        if (dia.bloquesDisponibles.length > 0) {

          dia.bloquesDisponibles.forEach(bloque => {

            const btn = document.createElement("button");
            btn.textContent = bloque.hora;
            btn.className = "horario-btn";

            btn.onclick = () => {
              if (!servicioSeleccionado) {
                alert("Primero seleccioná un servicio");
                return;
              }

              alert("Turno elegido:\nServicio: " + servicioSeleccionado +
                    "\nFecha: " + bloque.fecha +
                    "\nHora: " + bloque.hora);
            };

            contenedor.appendChild(btn);
          });

        }

        contenedor.appendChild(document.createElement("hr"));

      });

    })
    .catch(err => {
      alert("Error cargando horarios.");
      console.error(err);
    });
}

</script>

</body>
</html>
