<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 30px;
}

h1 { margin-bottom: 20px; }

input {
  padding: 8px;
  width: 250px;
  margin-right: 10px;
}

button {
  padding: 8px 14px;
  cursor: pointer;
}

.servicio-btn {
  border: 1px solid #888;
  background: #eee;
  margin-right: 10px;
}

.servicio-btn.activo {
  background: #72bd99;
  color: white;
  border: none;
}

.horario-btn {
  padding: 6px 10px;
  margin: 5px;
  border: 1px solid #888;
  background: #f5f5f5;
  cursor: pointer;
}

.horario-btn:hover {
  background: #72bd99;
  color: white;
}

.dia {
  margin-top: 25px;
  border-top: 1px solid #ccc;
  padding-top: 10px;
}

#agendaSection {
  display: none;
}
</style>
</head>

<body>

<h1>Agenda Online</h1>

<!-- LOGIN -->
<div id="loginSection">
  <h3>Ingres√° tu clave de acceso</h3>
  <input type="text" id="claveInput" placeholder="Ej: Casa Azul">
  <button onclick="validarClave()">Ingresar</button>
  <p id="mensajeLogin" style="color:red;"></p>
</div>

<!-- AGENDA -->
<div id="agendaSection">

  <h3>1Ô∏è‚É£ Eleg√≠ el servicio</h3>

  <button class="servicio-btn" onclick="seleccionarServicio(this,'Facial')">Facial</button>
  <button class="servicio-btn" onclick="seleccionarServicio(this,'Limpieza')">Limpieza</button>
  <button class="servicio-btn" onclick="seleccionarServicio(this,'Corporal')">Corporal</button>

  <br><br>

  <h3>2Ô∏è‚É£ Eleg√≠ horario disponible</h3>
  <button onclick="cargarHorarios()">Ver Horarios Disponibles</button>

  <div id="agenda"></div>

</div>

<script>

const API_URL = "https://script.google.com/macros/s/AKfycbzy5SdhMM1ofS7Mkcs-yzbgV_I7RUoIRUBBTL_Ns2p0vAJ9VS4W_fAf_-sY-_hYjFZ6/exec";

let servicioSeleccionado = null;


// üîê VALIDAR CLAVE
function validarClave() {

  const clave = document.getElementById("claveInput").value.trim();

  if (!clave) {
    document.getElementById("mensajeLogin").innerText = "Ingres√° una clave.";
    return;
  }

  fetch(`${API_URL}?action=validarClave&clave=${encodeURIComponent(clave)}`)
    .then(r => r.json())
    .then(res => {

      if (res.valido) {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("agendaSection").style.display = "block";
      } else {
        document.getElementById("mensajeLogin").innerText = "Clave incorrecta.";
      }

    })
    .catch(() => {
      document.getElementById("mensajeLogin").innerText = "Error de conexion.";
    });
}


// üü¢ SELECCIONAR SERVICIO
function seleccionarServicio(btn, servicio) {

  servicioSeleccionado = servicio;

  document.querySelectorAll(".servicio-btn")
    .forEach(b => b.classList.remove("activo"));

  btn.classList.add("activo");
}


// üìÖ CARGAR HORARIOS
function cargarHorarios() {

  fetch(API_URL)
    .then(r => r.json())
    .then(data => {

      const contenedor = document.getElementById("agenda");
      contenedor.innerHTML = "";

      data.forEach(dia => {

        const divDia = document.createElement("div");
        divDia.className = "dia";

        const titulo = document.createElement("h4");
        titulo.textContent = formatearFecha(dia.fecha) + " - " + dia.bloquesDisponibles.length + " turnos";
        divDia.appendChild(titulo);

        dia.bloquesDisponibles.forEach(bloque => {

          const btn = document.createElement("button");
          btn.className = "horario-btn";
          btn.textContent = bloque.hora;

          btn.onclick = () => reservarTurno(bloque.fecha, bloque.hora);

          divDia.appendChild(btn);
        });

        contenedor.appendChild(divDia);
      });

    })
    .catch(() => alert("Error cargando horarios."));
}


// üü£ RESERVAR TURNO
function reservarTurno(fecha, hora) {

  if (!servicioSeleccionado) {
    alert("Selecciona un servicio.");
    return;
  }

  fetch(`${API_URL}?action=reservar&fecha=${fecha}&hora=${hora}&servicio=${servicioSeleccionado}`)
    .then(r => r.json())
    .then(res => {

      if (res.ok) {
        alert("Turno reservado correctamente");
        cargarHorarios();
      } else {
        alert("Error al reservar");
      }

    })
    .catch(() => alert("Error de conexion."));
}


// üß† FORMATEAR FECHA PARA MOSTRAR LINDO
function formatearFecha(fechaISO) {

  const fecha = new Date(fechaISO);

  const opciones = {
    weekday: 'long',
    day: 'numeric',
    month: 'long'
  };

  let fechaFormateada = fecha.toLocaleDateString('es-AR', opciones);

  return fechaFormateada.charAt(0).toUpperCase() + fechaFormateada.slice(1);
}

</script>

</body>
</html>
