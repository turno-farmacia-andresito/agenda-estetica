<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
}

h1 {
  margin-bottom: 20px;
}

button {
  padding: 8px 14px;
  margin: 5px;
  cursor: pointer;
}

.servicio-activo {
  background-color: #72bd99;
  color: white;
  border: none;
}

.dia {
  margin-top: 20px;
  padding: 10px 0;
  border-bottom: 1px solid #ddd;
}

.horarios button {
  margin: 5px 5px 5px 0;
}
</style>
</head>

<body>

<h1>Agenda Online</h1>

<h3>1️⃣ Elegí el servicio</h3>
<button onclick="seleccionarServicio(this)">Facial</button>
<button onclick="seleccionarServicio(this)">Limpieza</button>
<button onclick="seleccionarServicio(this)">Corporal</button>

<hr>

<h3>2️⃣ Elegí horario disponible</h3>
<button onclick="cargarHorarios()">Ver Horarios Disponibles</button>

<div id="agenda"></div>

<script>

let servicioSeleccionado = null;

function seleccionarServicio(btn) {
  document.querySelectorAll("button").forEach(b => {
    if (b.innerText === "Facial" || b.innerText === "Limpieza" || b.innerText === "Corporal") {
      b.classList.remove("servicio-activo");
    }
  });

  btn.classList.add("servicio-activo");
  servicioSeleccionado = btn.innerText;
}

function cargarHorarios() {

  fetch("https://script.google.com/macros/s/AKfycbyoUI9SV-YyKHEVNJoWrocLm6QYuYUjq-mY90kLedJwJMrqI_OAItkeAbW32ejQVRVf/exec")
  .then(res => res.json())
  .then(data => {

    const agenda = document.getElementById("agenda");
    agenda.innerHTML = "";

    data.forEach(dia => {

      const contenedorDia = document.createElement("div");
      contenedorDia.className = "dia";

      const titulo = document.createElement("strong");
      titulo.innerText = dia.fecha + " - " + dia.bloquesDisponibles.length + " turnos";
      contenedorDia.appendChild(titulo);

      const contHorarios = document.createElement("div");
      contHorarios.className = "horarios";

      dia.bloquesDisponibles.forEach(b => {
        const btnHora = document.createElement("button");
        btnHora.innerText = b.hora;
        btnHora.onclick = () => reservarTurno(b.fecha, b.hora);
        contHorarios.appendChild(btnHora);
      });

      contenedorDia.appendChild(contHorarios);
      agenda.appendChild(contenedorDia);
    });

  })
  .catch(err => {
    alert("Error cargando horarios");
    console.log(err);
  });
}

function reservarTurno(fecha, hora) {
  if (!servicioSeleccionado) {
    alert("Primero elegí un servicio");
    return;
  }

  alert("Turno seleccionado:\nServicio: " + servicioSeleccionado +
        "\nFecha: " + fecha +
        "\nHora: " + hora);
}

</script>

</body>
</html>
