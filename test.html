<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Agenda Online</title>

<style>
body {
  font-family: Arial;
  max-width: 900px;
  margin: 40px auto;
}

h1 {
  margin-bottom: 30px;
}

button {
  padding: 8px 14px;
  margin: 5px;
  cursor: pointer;
}

.servicio-activo {
  background: #72bd99;
  color: white;
  border: none;
}

.dia {
  margin-top: 25px;
  padding-top: 10px;
  border-top: 1px solid #ccc;
}

.hora-btn {
  margin: 5px 5px 5px 0;
}

</style>
</head>

<body>

<h1>Agenda Online</h1>

<h3>1️⃣ Elegí el servicio</h3>

<button onclick="seleccionarServicio(this,'Facial')">Facial</button>
<button onclick="seleccionarServicio(this,'Limpieza')">Limpieza</button>
<button onclick="seleccionarServicio(this,'Corporal')">Corporal</button>

<hr>

<h3>2️⃣ Elegí horario disponible</h3>

<button onclick="cargarHorarios()">Ver Horarios Disponibles</button>

<div id="agenda"></div>


<script>

const API_URL = "https://script.google.com/macros/s/AKfycbzYu5gwKCHJM-rt0btK-mM2GIBgVl0vnAxAduYFBMTacESilsl_fjb19Cww8KCc598a/exec";

let servicioSeleccionado = null;



function seleccionarServicio(btn, servicio) {

  servicioSeleccionado = servicio;

  document.querySelectorAll("button").forEach(b => {
    b.classList.remove("servicio-activo");
  });

  btn.classList.add("servicio-activo");
}



function cargarHorarios() {

  fetch(API_URL + "?action=generarAgenda")
    .then(res => res.json())
    .then(data => {

      const agendaDiv = document.getElementById("agenda");
      agendaDiv.innerHTML = "";

      data.forEach(dia => {

        const contenedorDia = document.createElement("div");
        contenedorDia.className = "dia";

        const titulo = document.createElement("h4");
        titulo.innerText = dia.fecha + " - " + dia.bloquesDisponibles.length + " turnos";
        contenedorDia.appendChild(titulo);

        dia.bloquesDisponibles.forEach(b => {

          const btnHora = document.createElement("button");
          btnHora.innerText = b.hora;
          btnHora.className = "hora-btn";

          btnHora.onclick = () => reservarTurno(b.fecha, b.hora);

          contenedorDia.appendChild(btnHora);
        });

        agendaDiv.appendChild(contenedorDia);
      });

    });
}



function reservarTurno(fecha, hora) {

  if (!servicioSeleccionado) {
    alert("Seleccioná un servicio primero");
    return;
  }

  fetch(API_URL + "?action=reservar&fecha=" + fecha + "&hora=" + hora + "&servicio=" + servicioSeleccionado)
    .then(res => res.json())
    .then(resp => {

      if (resp.ok) {
        alert("Turno reservado correctamente");
        cargarHorarios();
      } else {
        alert("Error al reservar");
      }

    });
}

</script>

</body>
</html>
