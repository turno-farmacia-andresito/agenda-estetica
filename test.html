<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Agenda Online</title>
  <style>
    body {
      font-family: Arial;
      max-width: 900px;
      margin: 40px auto;
    }

    h1 {
      margin-bottom: 20px;
    }

    .servicios button {
      margin: 5px;
      padding: 10px 20px;
      border: 1px solid #ccc;
      background: #f5f5f5;
      cursor: pointer;
      border-radius: 5px;
    }

    .servicios button.activo {
      background: #72bd99;
      color: white;
      border: none;
    }

    .bloque-dia {
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #ddd;
    }

    .horas button {
      margin: 5px;
      padding: 8px 15px;
      border: 1px solid #ccc;
      background: white;
      cursor: pointer;
      border-radius: 4px;
    }

    .horas button:hover {
      background: #eee;
    }
  </style>
</head>
<body>

<h1>Agenda Online</h1>

<h3>1️⃣ Elegí el servicio</h3>
<div class="servicios">
  <button onclick="seleccionarServicio(this)">Facial</button>
  <button onclick="seleccionarServicio(this)">Limpieza</button>
  <button onclick="seleccionarServicio(this)">Corporal</button>
</div>

<h3 style="margin-top:30px;">2️⃣ Elegí horario disponible</h3>
<button onclick="cargarAgenda()">Ver Horarios Disponibles</button>

<div id="agenda"></div>

<script>

let servicioSeleccionado = null;

function seleccionarServicio(btn) {
  document.querySelectorAll(".servicios button").forEach(b => b.classList.remove("activo"));
  btn.classList.add("activo");
  servicioSeleccionado = btn.innerText;
}

function cargarAgenda() {

  fetch("https://script.google.com/macros/s/AKfycbzAjtvKFAKkVQ3vJthzmmRlZewXEtIW9SgdsqUgWHYvKM7sxx53hGCT7FqIRC-O-VYO/exec?action=generarAgenda")
    .then(res => res.json())
    .then(data => {

      const contenedor = document.getElementById("agenda");
      contenedor.innerHTML = "";

      data.forEach(dia => {

        const bloque = document.createElement("div");
        bloque.className = "bloque-dia";

        const titulo = document.createElement("h4");
        titulo.innerText = dia.fecha + " - " + dia.bloquesDisponibles.length + " turnos";
        bloque.appendChild(titulo);

        const horasDiv = document.createElement("div");
        horasDiv.className = "horas";

        dia.bloquesDisponibles.forEach(h => {

          const btn = document.createElement("button");
          btn.innerText = h.hora;

          btn.onclick = function() {

            if (!servicioSeleccionado) {
              alert("Primero seleccioná un servicio");
              return;
            }

            const nombre = prompt("Ingresá tu nombre");
            if (!nombre) return;

            alert("Reserva simulada:\n" +
                  servicioSeleccionado + "\n" +
                  h.fecha + " " + h.hora + "\n" +
                  "Cliente: " + nombre);
          };

          horasDiv.appendChild(btn);

        });

        bloque.appendChild(horasDiv);
        contenedor.appendChild(bloque);

      });

    })
    .catch(err => {
      alert("Error cargando agenda");
      console.error(err);
    });
}

</script>

</body>
</html>
